<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    /* ÙƒÙ„ Ø§Ù„Ù€ CSS Ø§Ù„Ø£ØµÙ„ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ù‡Ù†Ø§ ÙƒÙ…Ø§ Ù‡Ùˆ (Ø§Ù†Ø³Ø®ÙŠÙ‡ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„ÙŠ Ø£Ø±Ø³Ù„ØªÙŠÙ‡) */
    body { box-sizing: border-box; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: auto; }
    .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); overflow: hidden; transition: all 0.3s ease; }
    .card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.04); }
    .card-header { background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%); padding: 32px; position: relative; overflow: hidden; }
    .card-header::before { content: ''; position: absolute; top: -50%; right: -10%; width: 300px; height: 300px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; }
    .stats-card { background: white; border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s ease; border: 2px solid #f1f5f9; }
    .stats-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px -4px rgba(0, 0, 0, 0.1); border-color: #3b82f6; }
    .stats-icon { width: 64px; height: 64px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 32px; margin: 0 auto 16px; box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.1); }
    .search-input { padding: 14px 20px; border: 2px solid #e2e8f0; border-radius: 12px; outline: none; transition: all 0.3s ease; background: white; }
    .search-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
    .modern-button { padding: 12px 24px; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; border: none; outline: none; white-space: nowrap; }
    .modern-button:hover { transform: translateY(-2px); box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.15); }
    .modern-table { width: 100%; border-collapse: collapse; }
    .modern-table thead tr { background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); }
    .modern-table th { padding: 18px 16px; text-align: right; font-weight: 700; color: #334155; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid #e2e8f0; }
    .modern-table td { padding: 20px 16px; border-bottom: 1px solid #f1f5f9; }
    .modern-table tbody tr:hover { background: #f8fafc; }
    .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 13px; }
    .status-active { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; border: 2px solid #10b981; }
    .status-pending { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; border: 2px solid #f59e0b; }
    .date-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 600; background: #f1f5f9; color: #475569; }
    .date-expired { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b; border: 2px solid #ef4444; }
    .date-warning { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; border: 2px solid #f59e0b; }
    .link-button { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; border: none; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; }
    .link-button:hover { transform: translateY(-2px); box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.2); }
    .toast { position: fixed; bottom: 24px; right: 24px; padding: 16px 24px; border-radius: 12px; color: white; font-weight: 600; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2); z-index: 2000; animation: toastSlideIn 0.3s ease; max-width: 400px; }
    @keyframes toastSlideIn { from { opacity: 0; transform: translateX(100px); } to { opacity: 1; transform: translateX(0); } }
    .toast-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .action-buttons { display: flex; gap: 8px; justify-content: center; }
    .icon-button { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 6px; }
    .btn-edit { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; }
    @media (max-width: 768px) { .card-header { padding: 20px; } .stats-icon { width: 48px; height: 48px; font-size: 24px; } .modern-table { font-size: 13px; } .modern-table th, .modern-table td { padding: 12px 8px; } }
  </style>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-full">
  <div id="app" class="h-full"></div>
  <script>
    let config = {
      background_color: "#f0f4f8",
      primary_action_color: "#3b82f6",
      secondary_action_color: "#10b981",
      font_family: "Tajawal",
      font_size: 16,
      system_title: "Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©",
      search_placeholder: "Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚Ø©ØŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„ÙƒÙˆØ¯...",
      status_active: "Ø³Ø§Ø±ÙŠØ©"
    };

    let currentFilter = 'all';
    let searchQuery = '';
    let allProjects = [];

    const initialProjects = [
      // Ø§Ù„Ù€ 24 ØªØµØ±ÙŠØ­ ÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· (Ø§Ù†Ø³Ø®ÙŠÙ‡Ø§ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„ÙŠ Ø£Ø±Ø³Ù„ØªÙŠÙ‡)
      { id: "1", region: "Ø¨Ø±ÙŠØ¯Ø© (Ø´Ø±Ù‚)", name: "Ø§Ù„Ù‚Ø§Ø¹ Ø§Ù„Ø¨Ø§Ø±Ø¯ Ø´Ø±Ù‚ Ù…Ø¯ÙŠÙ†Ø© Ø¨Ø±ÙŠØ¯Ø© - Ø¹Ù‚Ø¯ Ø±Ù‚Ù… (1)", code: "1379", request_number: "EPC2-2025-006274", status: "Ø³Ø§Ø±ÙŠØ©", link: "https://nwc365-my.sharepoint.com/:b:/r/personal/malnejaidi_nwc_com_sa/Documents/Munira-EnvNorth/%D8%A7%D9%84%D8%AA%D8%B5%D8%A7%D8%B1%D9%8A%D8%AD%20%D8%A7%D9%84%D8%A8%D9%8A%D8%A6%D9%8A%D8%A9/%D8%A7%D9%84%D8%AA%D8%B5%D8%A7%D8%B1%D9%8A%D8%AD%20%D8%A7%D9%84%D8%A8%D9%8A%D8%A6%D9%8A%D8%A9%20%D9%84%D9%85%D8%B4%D8%A7%D8%B1%D9%8A%D8%B9%20%D8%A7%D9%84%D8%AA%D9%86%D9%81%D9%8A%D8%B0/%D8%B4%D8%B1%D9%82%20%D8%A8%D8%B1%D9%8A%D8%AF%D8%A9%20%D8%B9%D9%82%D8%AF%20%D8%B1%D9%82%D9%85%20-1%20%201379.pdf?csf=1&web=1&e=SBMFqD", issue_date: "2025-11-04", expiry_date: "2028-11-04" },
      // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø­ØªÙ‰ 24 (Ù…Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·)
      { id: "24", region: "Ø§Ù„Ø±Ø³", name: "Ø¬Ù†ÙˆØ¨ Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø±Ø³", code: "1354", request_number: "", status: "Ù„Ù… ÙŠØµØ¯Ø±", link: "", issue_date: "", expiry_date: "" }
    ];

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function getFilteredProjects() {
      let filtered = allProjects;
      if (currentFilter !== 'all') filtered = filtered.filter(p => p.status === currentFilter);
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filtered = filtered.filter(p => p.region.toLowerCase().includes(query) || p.name.toLowerCase().includes(query) || p.code.toLowerCase().includes(query) || (p.request_number && p.request_number.toLowerCase().includes(query)));
      }
      return filtered;
    }

    function formatDate(dateString) {
      if (!dateString) return '-';
      const date = new Date(dateString);
      return date.toLocaleDateString('ar-SA', { year: 'numeric', month: '2-digit', day: '2-digit' });
    }

    function getDateStatus(expiryDateString) {
      if (!expiryDateString) return '';
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const expiryDate = new Date(expiryDateString);
      expiryDate.setHours(0, 0, 0, 0);
      const diffDays = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
      if (diffDays < 0) return 'expired';
      if (diffDays <= 90) return 'warning';
      return 'valid';
    }

    function getCurrentDate() {
      return new Date().toLocaleDateString('ar-SA', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
    }

    function getCurrentTime() {
      return new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
    }

    function renderApp() {
      const app = document.getElementById('app');
      const baseFontSize = config.font_size;
      const displayFont = `${config.font_family}, Arial, sans-serif`;
      const filteredProjects = getFilteredProjects();
      const totalProjects = allProjects.length;
      const activeProjects = allProjects.filter(p => p.status === config.status_active).length;
      const pendingProjects = allProjects.filter(p => p.status === 'Ù„Ù… ÙŠØµØ¯Ø±').length;

      app.innerHTML = `
        <div class="w-full h-full" style="background: ${config.background_color}; padding: ${baseFontSize * 2}px; font-family: ${displayFont}; overflow-y: auto;">
          <div style="max-width: 1600px; margin: 0 auto;">
            <div class="card" style="margin-bottom: ${baseFontSize * 2}px;">
              <div class="card-header">
                <div style="position: relative; z-index: 1;">
                  <h1 style="font-size: ${baseFontSize * 2.5}px; font-weight: 800; color: #ffffff;">${config.system_title}</h1>
                  <div style="display: flex; align-items: center; gap: ${baseFontSize}px; font-size: ${baseFontSize * 0.95}px; color: rgba(255,255,255,0.9);">
                    <span>ğŸ“… ${getCurrentDate()}</span>
                    <span>â€¢</span>
                    <span>ğŸ• ${getCurrentTime()}</span>
                  </div>
                </div>
              </div>
              <div style="padding: ${baseFontSize * 2}px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: ${baseFontSize * 1.5}px;">
                <div class="stats-card">
                  <div class="stats-icon" style="background: linear-gradient(135deg, ${config.primary_action_color} 0%, #2563eb 100%);">ğŸ“Š</div>
                  <div style="font-size: ${baseFontSize * 0.9}px; color: #64748b; font-weight: 600;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
                  <div style="font-size: ${baseFontSize * 2.5}px; font-weight: 800; color: ${config.primary_action_color};">${totalProjects}</div>
                </div>
                <div class="stats-card">
                  <div class="stats-icon" style="background: linear-gradient(135deg, ${config.secondary_action_color} 0%, #059669 100%);">âœ…</div>
                  <div style="font-size: ${baseFontSize * 0.9}px; color: #64748b; font-weight: 600;">Ø§Ù„ØªØµØ§Ø±ÙŠØ­ Ø§Ù„Ø³Ø§Ø±ÙŠØ©</div>
                  <div style="font-size: ${baseFontSize * 2.5}px; font-weight: 800; color: ${config.secondary_action_color};">${activeProjects}</div>
                </div>
                <div class="stats-card">
                  <div class="stats-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">â³</div>
                  <div style="font-size: ${baseFontSize * 0.9}px; color: #64748b; font-weight: 600;">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
                  <div style="font-size: ${baseFontSize * 2.5}px; font-weight: 800; color: #f59e0b;">${pendingProjects}</div>
                </div>
              </div>
            </div>

            <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† empty state Ø£Ùˆ Ø²Ø± -->
            <div class="card">
              <div style="padding: ${baseFontSize * 1.5}px ${baseFontSize * 2}px;">
                <div style="display: flex; gap: ${baseFontSize}px; align-items: center; flex-wrap: wrap; margin-bottom: ${baseFontSize * 1.5}px;">
                  <div style="flex: 1; min-width: 300px;">
                    <input type="text" id="search-input" class="search-input" placeholder="${config.search_placeholder}" style="width: 100%; font-size: ${baseFontSize}px; font-family: ${displayFont};" value="${searchQuery}" />
                  </div>
                </div>
                <div style="display: flex; gap: ${baseFontSize * 0.75}px; flex-wrap: wrap;">
                  <button onclick="currentFilter='all'; renderApp()" class="modern-button" style="background: ${currentFilter === 'all' ? 'linear-gradient(135deg, ${config.primary_action_color} 0%, #2563eb 100%)' : '#ffffff'}; color: ${currentFilter === 'all' ? '#ffffff' : '#1e293b'};">
                    Ø§Ù„ÙƒÙ„ (${totalProjects})
                  </button>
                  <button onclick="currentFilter='${config.status_active}'; renderApp()" class="modern-button" style="background: ${currentFilter === config.status_active ? 'linear-gradient(135deg, ${config.secondary_action_color} 0%, #059669 100%)' : '#ffffff'}; color: ${currentFilter === config.status_active ? '#ffffff' : '#1e293b'};">
                    ${config.status_active} (${activeProjects})
                  </button>
                  <button onclick="currentFilter='Ù„Ù… ÙŠØµØ¯Ø±'; renderApp()" class="modern-button" style="background: ${currentFilter === 'Ù„Ù… ÙŠØµØ¯Ø±' ? 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)' : '#ffffff'}; color: ${currentFilter === 'Ù„Ù… ÙŠØµØ¯Ø±' ? '#ffffff' : '#1e293b'};">
                    Ù„Ù… ÙŠØµØ¯Ø± (${pendingProjects})
                  </button>
                </div>
              </div>
              <div style="overflow-x: auto;">
                <table class="modern-table" style="font-size: ${baseFontSize * 0.95}px;">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                      <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                      <th>Ø§Ù„ÙƒÙˆØ¯</th>
                      <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                      <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                      <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±</th>
                      <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                      <th>Ø§Ù„Ù…Ø³ØªÙ†Ø¯</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${filteredProjects.map((project, index) => {
                      const dateStatus = getDateStatus(project.expiry_date);
                      return `
                        <tr>
                          <td style="text-align: center; font-weight: 700; color: ${config.primary_action_color};">${index + 1}</td>
                          <td>${project.region}</td>
                          <td>${project.name}</td>
                          <td style="text-align: center;"><span style="background: #f1f5f9; padding: 6px 12px; border-radius: 6px; font-weight: 700; color: ${config.primary_action_color};">${project.code}</span></td>
                          <td style="text-align: center;">${project.request_number || '-'}</td>
                          <td style="text-align: center;"><span class="status-badge ${project.status === config.status_active ? 'status-active' : 'status-pending'}">${project.status === config.status_active ? 'âœ“' : 'â³'} ${project.status}</span></td>
                          <td style="text-align: center;"><span class="date-badge">ğŸ“… ${formatDate(project.issue_date)}</span></td>
                          <td style="text-align: center;"><span class="date-badge ${dateStatus === 'expired' ? 'date-expired' : dateStatus === 'warning' ? 'date-warning' : ''}">${project.expiry_date ? (dateStatus === 'expired' ? 'âš ï¸ ' : dateStatus === 'warning' ? 'â° ' : 'ğŸ“… ') + formatDate(project.expiry_date) : '-'}</span></td>
                          <td style="text-align: center;">${project.link ? `<a href="${project.link}" target="_blank" class="link-button">Ø¹Ø±Ø¶ â†—</a>` : '<span style="color: #94a3b8; font-style: italic;">Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©</span>'}</td>
                        </tr>
                      `;
                    }).join('')}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      `;

      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          searchQuery = e.target.value;
          renderApp();
        });
      }
    }

    // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    allProjects = initialProjects.map(p => ({ ...p, __backendId: p.id }));
    showToast('ØªÙ… ØªØ­Ù…ÙŠÙ„ 24 ØªØµØ±ÙŠØ­ Ø¨Ù†Ø¬Ø§Ø­! âœ…', 'success');
    renderApp();
  </script>
</body>
</html>
